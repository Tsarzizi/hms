# 医院绩效管理系统 - 后端需求文档（基于实际数据库）

## 1. 数据库结构说明

### 1.1 主要数据视图

- **医生绩效视图**: `m_v_workload_doc_perform_total`
- **科室绩效视图**: `m_v_workload_dep_perform_total`

### 1.2 核心字段说明

| 前端字段名              | 数据库字段     | 说明                  |
| :---------------------- | :------------- | :-------------------- |
| id                      | 绩效科室ID     | 科室唯一标识          |
| departmentCategory      | 绩效科室类别   | 临床/门诊/医技/行政等 |
| type                    | 绩效科室类型   | 内科/外科/妇产科等    |
| departmentName          | 绩效科室名称   | 具体科室名称          |
| staffCount              | 人数           | 科室人员数量          |
| settlementIncome        | 结算收入       | 科室总收入            |
| directCost              | 科室直接成本   | 科室直接成本          |
| totalPerformance        | 绩效总额       | 总绩效金额            |
| perCapitaPerformance    | 人均绩效       | 绩效总额/人数         |
| inpatientWorkloadPoints | 住院工作量点数 | 住院相关工作量        |
| workloadUnitPrice       | 工作量单价     | 单位点数价格          |
| workloadCoefficient     | 工作量系数     | 工作量调整系数        |

## 2. API接口规范（更新版）

### 2.1 获取绩效数据

**GET** `/api/hospital-performance/performance-data`

**查询参数**:

sql

```
-- 实际SQL实现
SELECT yyyy_mm,
    "绩效科室ID",
    "绩效科室名称",
    "绩效科室类别",
    "绩效科室类型",
    "同类序号",
    COALESCE("人数", 0) AS "人数",
    COALESCE("结算收入", 0) AS "结算收入",
    COALESCE("科室直接成本", 0) AS "科室直接成本",
    COALESCE("绩效总额", 0) AS "绩效总额",
    COALESCE("绩效总额", 0) / NULLIF(COALESCE("人数", 0), 0) AS "人均绩效",
    COALESCE("住院工作量点数", 0) AS "住院工作量点数",
    COALESCE("工作量单价", 0) AS "工作量单价",
    COALESCE("工作量系数", 0) AS "工作量系数",
    COALESCE("住院工作量绩效非手术介入", 0) AS "住院工作量绩效"
FROM (
    SELECT * FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT * FROM m_v_workload_dep_perform_total
) AS combined_data
WHERE yyyy_mm = :selected_date
AND ("绩效科室类别" = :department_category OR :department_category = '')
AND ("绩效科室类型" = :department_type OR :department_type = '')
AND ("绩效科室名称" = :department_name OR :department_name = '')
ORDER BY "绩效科室类别", "同类序号"
LIMIT :page_size OFFSET :offset
```



**分页查询**:

sql

```
-- 获取总记录数
SELECT COUNT(*) as total_count
FROM (
    SELECT * FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT * FROM m_v_workload_dep_perform_total
) AS combined_data
WHERE yyyy_mm = :selected_date
AND ("绩效科室类别" = :department_category OR :department_category = '')
AND ("绩效科室类型" = :department_type OR :department_type = '')
AND ("绩效科室名称" = :department_name OR :department_name = '')
```



### 2.2 获取汇总数据

**GET** `/api/hospital-performance/summary-data`

**SQL实现**:

sql

```
SELECT 
    SUM(COALESCE("人数", 0)) as total_staff_count,
    SUM(COALESCE("结算收入", 0)) as total_settlement_income,
    SUM(COALESCE("科室直接成本", 0)) as total_direct_cost,
    SUM(COALESCE("绩效总额", 0)) as total_performance,
    CASE 
        WHEN SUM(COALESCE("人数", 0)) > 0 
        THEN SUM(COALESCE("绩效总额", 0)) / SUM(COALESCE("人数", 0))
        ELSE 0 
    END as total_per_capita_performance,
    SUM(COALESCE("住院工作量点数", 0)) as total_inpatient_workload_points,
    SUM(COALESCE("住院工作量绩效非手术介入", 0)) as total_inpatient_workload_performance
FROM (
    SELECT * FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT * FROM m_v_workload_dep_perform_total
) AS combined_data
WHERE yyyy_mm = :selected_date
AND ("绩效科室类别" = :department_category OR :department_category = '')
AND ("绩效科室类型" = :department_type OR :department_type = '')
AND ("绩效科室名称" = :department_name OR :department_name = '')
```



### 2.3 获取筛选选项

**GET** `/api/hospital-performance/filter-options`

**SQL实现**:

sql

```
-- 获取科室类别
SELECT DISTINCT "绩效科室类别" 
FROM (
    SELECT "绩效科室类别" FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT "绩效科室类别" FROM m_v_workload_dep_perform_total
) AS categories
WHERE "绩效科室类别" IS NOT NULL
ORDER BY "绩效科室类别"

-- 获取科室类型
SELECT DISTINCT "绩效科室类型" 
FROM (
    SELECT "绩效科室类型" FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT "绩效科室类型" FROM m_v_workload_dep_perform_total
) AS types
WHERE "绩效科室类型" IS NOT NULL
ORDER BY "绩效科室类型"

-- 获取科室名称
SELECT DISTINCT "绩效科室名称" 
FROM (
    SELECT "绩效科室名称" FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT "绩效科室名称" FROM m_v_workload_dep_perform_total
) AS names
WHERE "绩效科室名称" IS NOT NULL
ORDER BY "绩效科室名称"
```



### 2.4 获取趋势数据

**GET** `/api/hospital-performance/trend-data`

**SQL实现**:

sql

```
SELECT 
    yyyy_mm as month,
    SUM(COALESCE("绩效总额", 0)) as total_performance,
    SUM(COALESCE("结算收入", 0)) as total_settlement_income,
    SUM(COALESCE("人数", 0)) as total_staff_count
FROM (
    SELECT yyyy_mm, "绩效总额", "结算收入", "人数" 
    FROM m_v_workload_doc_perform_total
    UNION ALL
    SELECT yyyy_mm, "绩效总额", "结算收入", "人数" 
    FROM m_v_workload_dep_perform_total
) AS combined_data
WHERE yyyy_mm >= :start_date AND yyyy_mm <= :end_date
GROUP BY yyyy_mm
ORDER BY yyyy_mm
```



### 2.5 导出Excel数据

**POST** `/api/hospital-performance/export`

**实现说明**:

- 使用绩效数据查询SQL获取全部数据（不分页）
- 生成Excel文件，包含明细数据和汇总数据
- 支持当前筛选条件

------

